<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√∫c v·ª£ iu 8 th√°ng 3 vui v·∫ª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Sans+MS&display=swap');
        canvas {
            display: block;
            margin: 20px auto;
            background-color: #2a2a2a; /* N·ªÅn canvas m√†u x√°m t·ªëi */
        }
        body {
            background-color: #2a2a2a; /* N·ªÅn x√°m t·ªëi gi·ªëng canvas */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* ·∫®n thanh cu·ªôn */
            position: relative;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #ff69b4; /* M√†u h·ªìng */
            color: white;
            border: 2px solid white; /* Vi·ªÅn tr·∫Øng */
            border-radius: 5px;
            margin-top: 20px;
        }
        button:hover {
            background-color: #ff85c0; /* M√†u h·ªìng s√°ng h∆°n khi hover */
        }
        .heart {
            position: absolute;
            font-size: 24px; /* K√≠ch th∆∞·ªõc tr√°i tim */
            pointer-events: auto; /* Cho ph√©p t∆∞∆°ng t√°c v·ªõi chu·ªôt */
            cursor: grab; /* Con tr·ªè khi c√≥ th·ªÉ k√©o th·∫£ */
            width: 40px; /* Chi·ªÅu r·ªông l·ªõn h∆°n cho hitbox */
            height: 40px; /* Chi·ªÅu cao l·ªõn h∆°n cho hitbox */
            display: flex; /* ƒê·ªÉ cƒÉn gi·ªØa tr√°i tim */
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <button id="startButton">Nh·∫•n v√†o ƒë√¢y n√® v·ª£ iu</button>
    <canvas id="heartCanvas" width="400" height="400"></canvas>
    <audio id="backgroundMusic" src="c.mp3" preload="auto"></audio>

    <script>
        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const music = document.getElementById('backgroundMusic'); // L·∫•y th·∫ª audio

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const scale = 10;
        let isDrawing = false;
        let currentT = 0;
        const targetFPS = 60;
        const frameInterval = 1000 / targetFPS;
        let pulseScale = 1;
        let pulseDirection = 1;

        // Draw heart function
        function drawHeart(t) {
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
            return {
                x: centerX + x * scale * pulseScale,
                y: centerY + y * scale * pulseScale
            };
        }

        // Animation function
        function animate() {
            if (!isDrawing) return;

            if (currentT <= 2 * Math.PI) {
                const point = drawHeart(currentT);
                
                if (currentT === 0) {
                    ctx.beginPath();
                    ctx.strokeStyle = '#ff0000'; // M√†u ƒë·ªè
                    ctx.lineWidth = 2; // ƒê·ªô d√†y n√©t b√™n trong
                    ctx.shadowBlur = 3; // Hi·ªáu ·ª©ng glow
                    ctx.shadowColor = '#ff0000'; // M√†u glow
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }

                ctx.stroke(); // Ensure the line is drawn properly
                currentT += 0.04; // Increment for drawing speed
            } else {
                isDrawing = false; // Stop drawing when finished
                drawText(); // Draw text at the center
                pulseHeart(); // Start pulsing effect
                startHeartDrops(); // B·∫Øt ƒë·∫ßu th·∫£ tr√°i tim m·ªói 0.6 gi√¢y
            }

            setTimeout(() => requestAnimationFrame(animate), frameInterval);
        }

        // Draw text function
        function drawText() {
            ctx.fillStyle = '#ffffff'; // Text color
            ctx.font = '20px "Comic Sans MS"'; // Ph√¥ng ch·ªØ l·ªõn h∆°n v√† ƒë·∫πp h∆°n
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.save();
            ctx.translate(centerX, centerY - 10); // ƒê∆∞a l√™n m·ªôt ch√∫t ƒë·ªÉ v√†o gi·ªØa
            ctx.rotate(-0.1); // Rotate text for artistic effect
            ctx.fillText("Ch√∫c v·ª£ iu 8/3", 0, 0);
            ctx.fillText("vui v·∫ª h·∫°nh ph√∫c üòò", 0, 20); // V·∫Ω d√≤ng th·ª© hai
            ctx.restore();
        }

        // Pulsing heart effect
        function pulseHeart() {
            pulseScale += pulseDirection * 0.02; // Increase speed of pulse
            if (pulseScale >= 1.1 || pulseScale <= 0.9) {
                pulseDirection *= -1; // Change direction
            }

            // Clear canvas and redraw the heart
            ctx.fillStyle = '#2a2a2a'; // N·ªÅn canvas x√°m t·ªëi
            ctx.fillRect(0, 0, canvas.width, canvas.height); // Clear canvas
            
            // Redraw the heart
            ctx.beginPath();
            for (let t = 0; t <= 2 * Math.PI; t += 0.01) {
                const point = drawHeart(t);
                if (t === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            }
            ctx.strokeStyle = '#ff0000'; // M√†u ƒë·ªè
            ctx.lineWidth = 2; // ƒê·ªô d√†y n√©t b√™n trong
            ctx.shadowBlur = 3; // Hi·ªáu ·ª©ng glow
            ctx.shadowColor = '#ff0000'; // M√†u glow
            ctx.stroke();

            // Draw text again to keep it visible
            drawText();

            // Call pulseHeart again after approximately 16.67 ms (1/60 seconds)
            setTimeout(pulseHeart, 16.67); 
        }

        // Create flying hearts effect
        function createFlyingHeart() {
            const hearts = ['üíñ', 'üíï', 'üíì', 'üíó', 'üíú']; // C√°c lo·∫°i tr√°i tim
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerText = hearts[Math.floor(Math.random() * hearts.length)]; // Ch·ªçn ng·∫´u nhi√™n tr√°i tim
            heart.style.left = Math.random() * window.innerWidth + 'px'; // V·ªã tr√≠ ng·∫´u nhi√™n
            heart.style.bottom = '0px'; // B·∫Øt ƒë·∫ßu t·ª´ d∆∞·ªõi c√πng
            document.body.appendChild(heart);

            // Animation
            let posY = 0;
            const speed = Math.random() * 2 + 1; // T·ªëc ƒë·ªô ng·∫´u nhi√™n

            const heartAnimation = setInterval(() => {
                posY += speed;
                heart.style.bottom = posY + 'px';

                // D·ª´ng l·∫°i khi tr√°i tim ra kh·ªèi m√†n h√¨nh
                if (posY > window.innerHeight) {
                    clearInterval(heartAnimation);
                    heart.remove(); // X√≥a tr√°i tim khi n√≥ ra kh·ªèi m√†n h√¨nh
                }
            }, 30); // Th·ªùi gian gi·ªØa c√°c khung h√¨nh

            // K√©o th·∫£ tr√°i tim
            let isDragging = false;
            let offsetX, offsetY;

            heart.addEventListener('mousedown', (e) => {
                isDragging = true;
                offsetX = e.clientX - heart.getBoundingClientRect().left;
                offsetY = e.clientY - heart.getBoundingClientRect().top;
                heart.style.cursor = 'grabbing'; // Chuy·ªÉn ƒë·ªïi con tr·ªè
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    heart.style.left = (e.clientX - offsetX) + 'px';
                    heart.style.top = (e.clientY - offsetY) + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                heart.style.cursor = 'grab'; // Tr·ªü l·∫°i con tr·ªè ban ƒë·∫ßu
            });
        }

        // Start dropping hearts every 0.6 seconds
        function startHeartDrops() {
            setInterval(createFlyingHeart, 600); // 600 ms = 0.6 gi√¢y
        }

        // Button click handler
        startButton.addEventListener('click', () => {
            music.play(); // Ph√°t nh·∫°c khi nh·∫•n n√∫t
            if (!isDrawing) {
                // Clear canvas with x√°m t·ªëi
                ctx.fillStyle = '#2a2a2a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                isDrawing = true;
                currentT = 0;
                startButton.style.display = 'none'; // Hide button after click
                animate();
            }
        });
    </script>
</body>
</html>